# 📋 项目说明 - 关于云服务的使用

## 🤔 项目使用了哪些服务？

### 1. 温州商学院CAS系统（✅ 本地服务）

**用途**: 学生登录认证

**位置**: `https://cas.wzbc.edu.cn`

**说明**: 
- ✅ 这是学校自己的服务器，不是云服务
- ✅ 完全在校园网内
- ✅ 无需修改

### 2. Supabase（⚠️ 云服务）

**用途**: 数据库和后端服务

**功能**:
- 存储报名信息
- 存储用户资料
- 存储作品文件
- 处理OAuth回调

**说明**:
- ⚠️ 这是一个云数据库服务
- ⚠️ 数据存储在Supabase的服务器上
- ⚠️ 需要联网访问

---

## 💡 为什么使用Supabase？

### 原因1: 开发效率

如果不使用Supabase，需要：
- 自己搭建数据库服务器（MySQL/PostgreSQL）
- 编写后端API代码（Node.js/PHP）
- 实现用户认证系统
- 实现文件上传功能
- 配置数据库备份

**工作量**: 至少需要2-3周

### 原因2: 免费额度充足

Supabase免费版提供：
- 500MB数据库存储
- 1GB文件存储
- 50,000次API请求/月

**对于学校比赛**: 完全够用！

### 原因3: 自动备份

- 每天自动备份数据
- 不怕数据丢失
- 可以随时恢复

---

## 🔄 如何改为完全本地部署？

### 方案对比

| 方案 | 优点 | 缺点 | 工作量 | 推荐度 |
|------|------|------|--------|--------|
| **保持Supabase** | 简单快速<br>免费<br>自动备份 | 需要联网<br>数据在云端 | 0天 | ⭐⭐⭐⭐⭐ |
| **Supabase自托管** | 数据在本地<br>功能完整 | 需要Docker<br>配置复杂 | 1-2天 | ⭐⭐⭐⭐ |
| **改用本地数据库** | 完全本地化<br>完全可控 | 需要重写代码<br>功能受限 | 2-3周 | ⭐⭐ |

### 方案1: 保持Supabase（推荐）

**适合**: 
- 学校有稳定的外网连接
- 对数据安全性要求不是特别高
- 希望快速上线

**优点**:
- ✅ 无需修改代码
- ✅ 10分钟完成配置
- ✅ 自动备份，不怕数据丢失

**缺点**:
- ⚠️ 需要联网（但学校服务器一般都有网）
- ⚠️ 数据在Supabase服务器（但有加密）

### 方案2: Supabase自托管

**适合**:
- 必须数据本地化
- 有技术人员支持
- 服务器配置较好

**步骤**:

1. **安装Docker**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install docker.io docker-compose

# 启动Docker
sudo systemctl start docker
```

2. **下载Supabase**
```bash
git clone https://github.com/supabase/supabase
cd supabase/docker
```

3. **配置环境变量**
```bash
cp .env.example .env
# 编辑.env，设置密码等
```

4. **启动Supabase**
```bash
docker-compose up -d
```

5. **访问**
```
http://localhost:3000
```

6. **修改项目配置**
```bash
# .env文件
VITE_SUPABASE_URL=http://你的服务器IP:8000
VITE_SUPABASE_ANON_KEY=从Supabase获取
```

**预计时间**: 1-2天（包括学习和配置）

**技术要求**: ⭐⭐⭐⭐

### 方案3: 改用本地数据库

**适合**:
- 完全不能使用云服务
- 有专业开发团队
- 有充足的开发时间

**需要做的事情**:

#### 1. 安装数据库

```bash
# 安装MySQL
sudo apt-get install mysql-server

# 或安装PostgreSQL
sudo apt-get install postgresql
```

#### 2. 创建数据库表

```sql
-- 用户表
CREATE TABLE profiles (
  id VARCHAR(36) PRIMARY KEY,
  username VARCHAR(50),
  real_name VARCHAR(50),
  student_id VARCHAR(20),
  email VARCHAR(100),
  role VARCHAR(20),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 报名表
CREATE TABLE registrations (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36),
  team_name VARCHAR(100),
  team_members TEXT,
  status VARCHAR(20),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES profiles(id)
);

-- 作品表
CREATE TABLE works (
  id VARCHAR(36) PRIMARY KEY,
  registration_id VARCHAR(36),
  title VARCHAR(200),
  description TEXT,
  file_url VARCHAR(500),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (registration_id) REFERENCES registrations(id)
);
```

#### 3. 编写后端API

需要创建一个后端服务（Node.js + Express）:

```javascript
// server.js
const express = require('express');
const mysql = require('mysql2');
const app = express();

// 数据库连接
const db = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: 'your_password',
  database: 'aigc_db'
});

// API路由
app.get('/api/registrations', (req, res) => {
  db.query('SELECT * FROM registrations', (err, results) => {
    if (err) return res.status(500).json({ error: err.message });
    res.json(results);
  });
});

app.post('/api/registrations', (req, res) => {
  const { user_id, team_name, team_members } = req.body;
  db.query(
    'INSERT INTO registrations (id, user_id, team_name, team_members) VALUES (?, ?, ?, ?)',
    [generateId(), user_id, team_name, team_members],
    (err, result) => {
      if (err) return res.status(500).json({ error: err.message });
      res.json({ success: true });
    }
  );
});

app.listen(3000, () => {
  console.log('Server running on port 3000');
});
```

#### 4. 修改前端代码

需要修改约50个文件：

- `src/db/supabase.ts` → 改为API调用
- `src/db/api.ts` → 重写所有数据库查询
- `src/contexts/AuthContext.tsx` → 改为本地认证
- `src/hooks/use-supabase-upload.ts` → 改为本地文件上传
- 所有使用Supabase的页面组件

#### 5. 实现文件上传

```javascript
// 文件上传API
const multer = require('multer');
const upload = multer({ dest: 'uploads/' });

app.post('/api/upload', upload.single('file'), (req, res) => {
  const file = req.file;
  res.json({ url: `/uploads/${file.filename}` });
});
```

**预计时间**: 2-3周

**技术要求**: ⭐⭐⭐⭐⭐

---

## 🎯 建议

### 对于小白用户

**强烈推荐方案1（保持Supabase）**

理由：
1. ✅ 配置简单，10分钟搞定
2. ✅ 免费额度完全够用
3. ✅ 自动备份，安全可靠
4. ✅ 学校服务器有网络，可以访问

### 对于技术人员

**如果必须本地化，推荐方案2（Supabase自托管）**

理由：
1. ✅ 数据在本地服务器
2. ✅ 功能完整，无需改代码
3. ✅ 配置相对简单（1-2天）
4. ✅ 可以随时迁移到云端

### 不推荐方案3

除非：
- 有专业开发团队
- 有充足的开发时间（2-3周）
- 有长期维护计划

---

## 📊 数据安全说明

### Supabase的安全性

1. **数据加密**
   - 传输加密（HTTPS）
   - 存储加密（AES-256）

2. **访问控制**
   - Row Level Security（行级安全）
   - API密钥认证
   - 只有授权用户能访问数据

3. **备份**
   - 每天自动备份
   - 可以随时导出数据

4. **合规性**
   - 符合GDPR标准
   - 符合SOC 2标准

### 如果担心数据安全

可以采取以下措施：

1. **定期导出数据**
```bash
# 在Supabase Dashboard导出CSV
# 保存到本地服务器
```

2. **使用Supabase自托管**
   - 数据完全在自己服务器
   - 完全可控

3. **敏感信息加密**
   - 在存入数据库前加密
   - 读取时解密

---

## ✅ 总结

### 当前项目状态

- ✅ 代码质量检查通过（87个文件，0错误）
- ✅ 使用Supabase云服务（可选自托管）
- ✅ 使用学校CAS认证（本地服务）
- ✅ 可以部署到学校服务器

### 推荐方案

**对于小白**: 使用Supabase云服务（方案1）
- 简单快速
- 免费够用
- 10分钟搞定

**对于技术人员**: 如果必须本地化，使用Supabase自托管（方案2）
- 数据在本地
- 功能完整
- 1-2天搞定

**不推荐**: 完全重写改用本地数据库（方案3）
- 工作量大（2-3周）
- 容易出错
- 需要长期维护

---

## 📞 需要帮助？

### 如果您想使用方案1（Supabase云服务）

请查看：**零基础部署指南.md**

### 如果您想使用方案2（Supabase自托管）

请联系技术支持，我们可以协助配置

### 如果您想使用方案3（完全本地化）

请联系开发团队，需要重新开发

---

**文档版本**: 1.0  
**更新日期**: 2025-12-03  
**建议**: 使用Supabase云服务（方案1）
