# ğŸ”§ é—®é¢˜æ’æŸ¥ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ å½“å‰é—®é¢˜

### é—®é¢˜1: æµè§ˆå™¨æ˜¾ç¤º"ä¸å®‰å…¨"
- **ç°è±¡**: è®¿é—® https://aigctmp.wzbc.edu.cn æ—¶ï¼Œæµè§ˆå™¨æ˜¾ç¤º"ä¸å®‰å…¨"
- **å·²é…ç½®**: SSLè¯ä¹¦å·²æ­£ç¡®é…ç½®åœ¨Apacheä¸­
- **è¯ä¹¦è·¯å¾„**: 
  - è¯ä¹¦: `/home/lw/projects/app-7z58i603if41/apache/wzbc-edu-cn-1024225915.crt`
  - ç§é’¥: `/home/lw/projects/app-7z58i603if41/apache/wzbc-edu-cn-1024225915_key.key`
  - è¯ä¹¦é“¾: `/home/lw/projects/app-7z58i603if41/apache/ca_bundle.crt`

### é—®é¢˜2: CASç™»å½•åè¿”å›æœªç™»å½•çŠ¶æ€
- **ç°è±¡**: ç‚¹å‡»"ç»Ÿä¸€èº«ä»½è®¤è¯"ï¼ŒæˆåŠŸè¿›å…¥å­¦æ ¡è®¤è¯ç•Œé¢ï¼Œè¾“å…¥è´¦å·å¯†ç åè¿”å›é¡¹ç›®ç•Œé¢ä»æ˜¾ç¤ºæœªç™»å½•
- **ç™»å½•æµç¨‹**: CASè®¤è¯æˆåŠŸ â†’ å›è°ƒåˆ°é¡¹ç›® â†’ æœªèƒ½æ­£ç¡®å¤„ç†ç™»å½•çŠ¶æ€

---

## ğŸ” é—®é¢˜1æ’æŸ¥ï¼šSSLè¯ä¹¦"ä¸å®‰å…¨"

### å¯èƒ½åŸå› åˆ†æ

#### åŸå› 1: è¯ä¹¦åŸŸåä¸åŒ¹é… â­ æœ€å¯èƒ½

**é—®é¢˜**: è¯ä¹¦æ–‡ä»¶åæ˜¯ `wzbc-edu-cn-1024225915.crt`ï¼Œå¯èƒ½æ˜¯ä¸º `*.wzbc.edu.cn` æˆ–å…¶ä»–åŸŸåç­¾å‘çš„

**æ£€æŸ¥æ–¹æ³•**:
```bash
# æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯
openssl x509 -in /home/lw/projects/app-7z58i603if41/apache/wzbc-edu-cn-1024225915.crt -text -noout | grep -A 2 "Subject:"

# æŸ¥çœ‹è¯ä¹¦æ”¯æŒçš„åŸŸå
openssl x509 -in /home/lw/projects/app-7z58i603if41/apache/wzbc-edu-cn-1024225915.crt -text -noout | grep -A 1 "Subject Alternative Name"
```

**é¢„æœŸç»“æœ**: åº”è¯¥åŒ…å« `aigctmp.wzbc.edu.cn` æˆ– `*.wzbc.edu.cn`

**å¦‚æœä¸åŒ¹é…**: éœ€è¦é‡æ–°ç”³è¯·è¯ä¹¦ï¼Œæˆ–ä½¿ç”¨é€šé…ç¬¦è¯ä¹¦

#### åŸå› 2: è¯ä¹¦é“¾ä¸å®Œæ•´

**é—®é¢˜**: ä¸­é—´è¯ä¹¦æœªæ­£ç¡®é…ç½®

**æ£€æŸ¥æ–¹æ³•**:
```bash
# åœ¨çº¿æ£€æŸ¥SSLé…ç½®
# è®¿é—®: https://www.ssllabs.com/ssltest/analyze.html?d=aigctmp.wzbc.edu.cn

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
openssl s_client -connect aigctmp.wzbc.edu.cn:443 -showcerts
```

**è§£å†³æ–¹æ³•**: ç¡®ä¿ `ca_bundle.crt` åŒ…å«å®Œæ•´çš„è¯ä¹¦é“¾

#### åŸå› 3: è¯ä¹¦è¿‡æœŸ

**æ£€æŸ¥æ–¹æ³•**:
```bash
# æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in /home/lw/projects/app-7z58i603if41/apache/wzbc-edu-cn-1024225915.crt -noout -dates
```

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: æ£€æŸ¥å¹¶ä¿®å¤è¯ä¹¦é…ç½®

```bash
# 1. æ£€æŸ¥è¯ä¹¦åŸŸå
cd /home/lw/projects/app-7z58i603if41/apache
openssl x509 -in wzbc-edu-cn-1024225915.crt -text -noout | grep -E "(Subject:|DNS:)"

# 2. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in wzbc-edu-cn-1024225915.crt -noout -dates

# 3. éªŒè¯è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…
openssl x509 -noout -modulus -in wzbc-edu-cn-1024225915.crt | openssl md5
openssl rsa -noout -modulus -in wzbc-edu-cn-1024225915_key.key | openssl md5
# ä¸¤ä¸ªMD5å€¼åº”è¯¥ç›¸åŒ

# 4. æµ‹è¯•SSLè¿æ¥
openssl s_client -connect aigctmp.wzbc.edu.cn:443 -servername aigctmp.wzbc.edu.cn
```

#### æ–¹æ¡ˆ2: å¦‚æœè¯ä¹¦åŸŸåä¸åŒ¹é…ï¼Œéœ€è¦é‡æ–°ç”³è¯·

**é€‰é¡¹A: ç”³è¯·æ–°çš„å•åŸŸåè¯ä¹¦**
- ä¸º `aigctmp.wzbc.edu.cn` å•ç‹¬ç”³è¯·è¯ä¹¦

**é€‰é¡¹B: ä½¿ç”¨é€šé…ç¬¦è¯ä¹¦**
- ç”³è¯· `*.wzbc.edu.cn` é€šé…ç¬¦è¯ä¹¦
- å¯ä»¥è¦†ç›–æ‰€æœ‰å­åŸŸå

**é€‰é¡¹C: ä¸´æ—¶ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰**
```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
cd /home/lw/projects/app-7z58i603if41/apache
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout aigctmp-selfsigned.key \
  -out aigctmp-selfsigned.crt \
  -subj "/C=CN/ST=Zhejiang/L=Wenzhou/O=WZBC/CN=aigctmp.wzbc.edu.cn"

# æ›´æ–°Apacheé…ç½®ä½¿ç”¨æ–°è¯ä¹¦
sudo nano /etc/apache2/sites-available/aigctmp.conf
# ä¿®æ”¹è¯ä¹¦è·¯å¾„ä¸ºæ–°ç”Ÿæˆçš„è¯ä¹¦
```

---

## ğŸ” é—®é¢˜2æ’æŸ¥ï¼šCASç™»å½•åæœªç™»å½•

### é—®é¢˜åˆ†æ

è¿™æ˜¯ä¸€ä¸ª**å…³é”®é—®é¢˜**ï¼é¡¹ç›®ä½¿ç”¨Supabaseäº‘æœåŠ¡å¤„ç†OAuthå›è°ƒï¼Œä½†æ‚¨è¦æ±‚**æœ¬åœ°éƒ¨ç½²ä¸ä½¿ç”¨äº‘æœåŠ¡**ã€‚

**å½“å‰ç™»å½•æµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡»ç™»å½•
  â†“
è·³è½¬åˆ°CASè®¤è¯é¡µé¢ âœ… æ­£å¸¸
  â†“
ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç  âœ… æ­£å¸¸
  â†“
CASè®¤è¯æˆåŠŸï¼Œè¿”å›æˆæƒç 
  â†“
å›è°ƒåˆ°: https://aigctmp.wzbc.edu.cn/auth/callback
  â†“
å‰ç«¯è°ƒç”¨Supabase Edge Functionå¤„ç†OAuth âŒ å¤±è´¥ï¼ˆéœ€è¦äº‘æœåŠ¡ï¼‰
  â†“
æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯
  â†“
ç™»å½•å¤±è´¥
```

### æ ¹æœ¬åŸå› 

**é¡¹ç›®ä¾èµ–Supabaseäº‘æœåŠ¡**ï¼ŒåŒ…æ‹¬ï¼š
1. **OAuthå›è°ƒå¤„ç†** - éœ€è¦Supabase Edge Function
2. **ç”¨æˆ·æ•°æ®å­˜å‚¨** - éœ€è¦Supabaseæ•°æ®åº“
3. **ä¼šè¯ç®¡ç†** - éœ€è¦Supabase Auth

**ä½†æ‚¨è¦æ±‚æœ¬åœ°éƒ¨ç½²ï¼Œä¸ä½¿ç”¨äº‘æœåŠ¡ï¼**

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆA: ç®€åŒ–ä¸ºçº¯å±•ç¤ºç½‘ç«™ï¼ˆæ¨èï¼‰âœ…

**ç§»é™¤ç™»å½•åŠŸèƒ½**ï¼Œåªä¿ç•™å±•ç¤ºåŠŸèƒ½ï¼š

1. ç§»é™¤ç™»å½•æŒ‰é’®
2. ç§»é™¤éœ€è¦ç™»å½•çš„é¡µé¢ï¼ˆæŠ¥åã€ä½œå“æäº¤ç­‰ï¼‰
3. æ·»åŠ æŠ¥åè”ç³»æ–¹å¼ï¼ˆé‚®ç®±ã€ç”µè¯ï¼‰

**ä¼˜ç‚¹**:
- éƒ¨ç½²ç®€å•
- æ— éœ€æ•°æ®åº“
- æ— éœ€äº‘æœåŠ¡
- ç»´æŠ¤æ–¹ä¾¿

**ç¼ºç‚¹**:
- æ— æ³•åœ¨çº¿æŠ¥å
- éœ€è¦çº¿ä¸‹æ”¶é›†æŠ¥åä¿¡æ¯

#### æ–¹æ¡ˆB: å¼€å‘æœ¬åœ°OAuthå¤„ç†ï¼ˆå¤æ‚ï¼‰

**éœ€è¦å¼€å‘æœ¬åœ°åç«¯API**æ¥å¤„ç†OAuthå›è°ƒï¼š

**æ¶æ„**:
```
å‰ç«¯ (React)
  â†“
æœ¬åœ°åç«¯ (Node.js + Express)
  â†“
æœ¬åœ°æ•°æ®åº“ (MySQL/PostgreSQL)
```

**éœ€è¦åšçš„å·¥ä½œ**:
1. å®‰è£…MySQLæˆ–PostgreSQLæ•°æ®åº“
2. å¼€å‘Node.jsåç«¯API
3. å®ç°OAuthå›è°ƒå¤„ç†
4. å®ç°ç”¨æˆ·ä¼šè¯ç®¡ç†
5. ä¿®æ”¹å‰ç«¯è¿æ¥æœ¬åœ°API

**å·¥ä½œé‡**: çº¦2-3å¤©

#### æ–¹æ¡ˆC: ä¿ç•™Supabaseäº‘æœåŠ¡ï¼ˆæœ€ç®€å•ï¼‰

**ç»§ç»­ä½¿ç”¨Supabase**ï¼Œä¸åšæœ¬åœ°éƒ¨ç½²ï¼š

**ä¼˜ç‚¹**:
- æ— éœ€ä¿®æ”¹ä»£ç 
- åŠŸèƒ½å®Œæ•´
- éƒ¨ç½²ç®€å•

**ç¼ºç‚¹**:
- ä¾èµ–äº‘æœåŠ¡
- éœ€è¦é…ç½®Supabase

---

## ğŸ¯ æ¨èè§£å†³æ–¹æ¡ˆ

### é’ˆå¯¹é—®é¢˜1ï¼ˆSSLè¯ä¹¦ï¼‰

**ç«‹å³æ‰§è¡Œ**:

```bash
# 1. æ£€æŸ¥è¯ä¹¦åŸŸå
cd /home/lw/projects/app-7z58i603if41/apache
openssl x509 -in wzbc-edu-cn-1024225915.crt -text -noout | grep -E "(Subject:|DNS:)"

# 2. æŸ¥çœ‹ç»“æœ
# å¦‚æœåŒ…å« aigctmp.wzbc.edu.cn æˆ– *.wzbc.edu.cnï¼Œè¯ä¹¦æ˜¯æ­£ç¡®çš„
# å¦‚æœä¸åŒ…å«ï¼Œéœ€è¦é‡æ–°ç”³è¯·è¯ä¹¦
```

**å¦‚æœè¯ä¹¦åŸŸåæ­£ç¡®ï¼Œä½†ä»æ˜¾ç¤ºä¸å®‰å…¨**:

å¯èƒ½æ˜¯æµè§ˆå™¨ç¼“å­˜é—®é¢˜ï¼š
```bash
# 1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# Chrome: Ctrl+Shift+Deleteï¼Œæ¸…é™¤æ‰€æœ‰ç¼“å­˜

# 2. é‡å¯Apache
sudo systemctl restart apache2

# 3. ä½¿ç”¨éšç§æ¨¡å¼è®¿é—®
# Chrome: Ctrl+Shift+N
```

### é’ˆå¯¹é—®é¢˜2ï¼ˆCASç™»å½•ï¼‰

**æˆ‘çš„å»ºè®®**: é€‰æ‹©æ–¹æ¡ˆAï¼ˆç®€åŒ–ä¸ºçº¯å±•ç¤ºç½‘ç«™ï¼‰

**åŸå› **:
1. æ‚¨æ˜¯é›¶åŸºç¡€ç”¨æˆ·
2. é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½ï¼ˆç™»å½•ã€æŠ¥åï¼‰ä¾èµ–äº‘æœåŠ¡
3. å¼€å‘æœ¬åœ°åç«¯éœ€è¦è¾ƒå¤šæŠ€æœ¯çŸ¥è¯†
4. çº¯å±•ç¤ºç½‘ç«™å¯ä»¥æ»¡è¶³åŸºæœ¬éœ€æ±‚

**å¦‚æœæ‚¨ç¡®å®éœ€è¦å®Œæ•´åŠŸèƒ½**ï¼Œæˆ‘å¯ä»¥ï¼š
1. å¸®æ‚¨é…ç½®Supabaseäº‘æœåŠ¡ï¼ˆå…è´¹ï¼‰
2. æˆ–è€…å¼€å‘å®Œæ•´çš„æœ¬åœ°åç«¯ç³»ç»Ÿï¼ˆéœ€è¦æ—¶é—´ï¼‰

---

## ğŸ“ ç«‹å³è¡ŒåŠ¨æ­¥éª¤

### ç¬¬1æ­¥ï¼šæ£€æŸ¥SSLè¯ä¹¦ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# è¿æ¥åˆ°æœåŠ¡å™¨
ssh lw@10.145.251.29

# æ£€æŸ¥è¯ä¹¦åŸŸå
cd /home/lw/projects/app-7z58i603if41/apache
openssl x509 -in wzbc-edu-cn-1024225915.crt -text -noout | grep -A 1 "Subject Alternative Name"

# å°†ç»“æœå‘Šè¯‰æˆ‘
```

### ç¬¬2æ­¥ï¼šå†³å®šç™»å½•åŠŸèƒ½æ–¹æ¡ˆ

**è¯·å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©**:

**é€‰é¡¹1**: ç®€åŒ–ä¸ºçº¯å±•ç¤ºç½‘ç«™ï¼ˆæ¨èï¼‰
- ç§»é™¤ç™»å½•åŠŸèƒ½
- æ·»åŠ æŠ¥åè”ç³»æ–¹å¼
- éƒ¨ç½²ç®€å•ï¼Œç«‹å³å¯ç”¨

**é€‰é¡¹2**: é…ç½®Supabaseäº‘æœåŠ¡
- ä¿ç•™å®Œæ•´åŠŸèƒ½
- éœ€è¦æ³¨å†ŒSupabaseè´¦å·
- æˆ‘ä¼šæä¾›è¯¦ç»†é…ç½®æŒ‡å—

**é€‰é¡¹3**: å¼€å‘æœ¬åœ°åç«¯ç³»ç»Ÿ
- å®Œå…¨æœ¬åœ°éƒ¨ç½²
- éœ€è¦å®‰è£…æ•°æ®åº“
- éœ€è¦2-3å¤©å¼€å‘æ—¶é—´

---

## ğŸ”§ ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

### å¦‚æœåªæ˜¯æƒ³å¿«é€Ÿæµ‹è¯•ç½‘ç«™

**1. å¿½ç•¥SSLè­¦å‘Šï¼ˆä»…æµ‹è¯•ç”¨ï¼‰**
```
åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"
```

**2. æš‚æ—¶ç§»é™¤ç™»å½•æŒ‰é’®**

ç¼–è¾‘ `src/components/common/Header.tsx`ï¼Œä¸´æ—¶éšè—ç™»å½•æŒ‰é’®ï¼š

```typescript
// æ‰¾åˆ°ç™»å½•æŒ‰é’®éƒ¨åˆ†ï¼Œæ·»åŠ  hidden å±æ€§
{user ? (
  // ... ç”¨æˆ·ä¿¡æ¯
) : (
  <Link to="/login" className="hidden">  {/* æ·»åŠ  hidden */}
    <Button size="sm" className="gap-2">
      <User className="w-4 h-4" />
      ç™»å½•
    </Button>
  </Link>
)}
```

é‡æ–°æ„å»ºå¹¶éƒ¨ç½²ï¼š
```bash
npm run build
./deploy.sh
```

---

## ğŸ“ éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ

**è¯·å‘Šè¯‰æˆ‘**:
1. SSLè¯ä¹¦æ£€æŸ¥çš„ç»“æœï¼ˆæ‰§è¡Œç¬¬1æ­¥åï¼‰
2. æ‚¨é€‰æ‹©å“ªä¸ªç™»å½•åŠŸèƒ½æ–¹æ¡ˆï¼ˆé€‰é¡¹1/2/3ï¼‰

æˆ‘ä¼šæ ¹æ®æ‚¨çš„é€‰æ‹©æä¾›è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-12-03  
**çŠ¶æ€**: ç­‰å¾…ç”¨æˆ·åé¦ˆ
